<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能网球分析系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0c162d 0%, #1a2a4a 100%);
            color: #e0f0ff;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* 网格背景效果 */
        body::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(rgba(18, 33, 66, 0.8) 1px, transparent 1px),
                linear-gradient(90deg, rgba(18, 33, 66, 0.8) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: -1;
        }

        /* 标题栏样式 */
        .header {
            background: rgba(10, 20, 40, 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(0, 167, 255, 0.5);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            position: relative;
            z-index: 10;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, #00c6ff, #0072ff, #00ffcc);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
            text-shadow: 0 0 15px rgba(0, 178, 255, 0.3);
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            font-size: 1.1rem;
            gap: 8px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff55;
            box-shadow: 0 0 10px #00ff55;
        }

        .datetime {
            font-size: 1.2rem;
            letter-spacing: 1px;
            color: #a0cfff;
        }

        /* 主内容区 */
        .dashboard {
            padding: 25px;
            display: grid;
            grid-template-columns: 0.5fr 2.5fr 1fr;
            gap: 25px;
            height: calc(100vh - 100px);
        }

        /* 视频监控区域 */
        .video-section {
            grid-column: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
            flex-grow: 1;
        }

        .camera-container {
            background: rgba(8, 18, 35, 0.7);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0, 120, 215, 0.3);
        }

        .camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: linear-gradient(45deg, #0a1a30, #0d2b50);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            pointer-events: none;
        }

        .camera-title {
            background: rgba(0, 40, 80, 0.7);
            color: #00ccff;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 1.2rem;
            align-self: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 180, 255, 0.3);
        }

        .camera-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
        }

        .camera-stats {
            background: rgba(0, 30, 60, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 150, 255, 0.3);
        }

        /* 数据面板 */
        .panel {
            background: rgba(8, 18, 35, 0.7);
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 120, 215, 0.3);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
        }

        .panel-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid rgba(0, 167, 255, 0.5);
            color: #00ccff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title i {
            font-size: 1rem;
        }

        .panel-content {
            flex: 1;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            color: #66aaff;
            font-size: 1rem;
            text-align: center;
            padding: 10px;
        }

        .panel-content .placeholder {
            max-width: 80%;
            line-height: 1.6;
        }

        .panel-content i {
            font-size: 2rem;
            margin-bottom: 10px;
            color: rgba(0, 180, 255, 0.5);
        }

        /* 右侧分析面板 - 更新样式 */
        .panel-right .panel-content {
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            max-height: calc(100vh - 200px);
            padding: 10px;
            position: relative;
        }

        .shot-evaluation {
            background: rgba(0, 30, 60, 0.7);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            width: 100%;
            border: 1px solid rgba(0, 150, 255, 0.3);
            opacity: 0;
            transform: translateY(-20px);
            animation: fadeIn 0.5s ease-out forwards;
        }

        .shot-evaluation.fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }

        .shot-evaluation h4 {
            color: #00ccff;
            margin-bottom: 5px;
        }

        .shot-evaluation p {
            color: #a0d0ff;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* 动画效果 */
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: translateY(-20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 200, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 200, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 200, 255, 0); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* 按钮样式 */
        .btn-expand {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease-in-out;
            cursor: pointer;
            margin: 10px auto;
            border: none;
        }

        .btn-expand:hover {
            width: 90%;
            border-radius: 30px;
        }

        .btn-expand:hover .btn-text {
            opacity: 1;
            width: auto;
            padding-left: 15px;
        }

        .btn-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
            white-space: nowrap;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .btn-expand i {
            font-size: 1rem;
        }

        /* 模态框样式 */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-backdrop.active {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: rgba(10, 20, 40, 0.95);
            border-radius: 18px;
            max-width: 95vw;
            max-height: 90vh;
            width: 95vw;
            padding: 20px;
            border: 1.5px solid rgba(0, 150, 255, 0.5);
            box-shadow: 0 15px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .modal-backdrop.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1.5px solid rgba(0, 150, 255, 0.3);
        }

        .modal-title {
            font-size: 1.8rem;
            color: #00ccff;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: #a0cfff;
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: #ffffff;
        }

        .modal-body {
            color: #a0d0ff;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1.3rem;
            overflow-y: auto;
            flex: 1;
            padding: 5px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            padding-top: 15px;
        }

        .modal-btn {
            background: rgba(0, 120, 215, 0.3);
            border: 1.5px solid rgba(0, 150, 255, 0.5);
            color: #a0d0ff;
            padding: 12px 25px;
            border-radius: 9px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn:hover {
            background: rgba(0, 150, 255, 0.5);
            color: #ffffff;
        }

        .modal-body img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 6px 23px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
        }

        /* 响应式调整 */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 0.5fr 1.5fr;
            }

            .video-section {
                grid-column: 1 / -1;
                grid-row: 1;
            }

            .panel-left {
                grid-column: 1;
                grid-row: 2;
            }

            .panel-right {
                grid-column: 2;
                grid-row: 2;
            }
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .panel-left, .panel-right {
                grid-column: 1;
            }

            .panel-right {
                grid-row: 3;
            }

            .header h1 {
                font-size: 2rem;
            }

            .btn-expand {
                width: 25px;
                height: 25px;
            }
        }

        /* 欢迎对话框样式 */
        .welcome-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: rgba(10, 20, 40, 0.95);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            border: 2px solid rgba(0, 167, 255, 0.7);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .welcome-modal.active {
            opacity: 1;
            pointer-events: auto;
            transform: translate(-50%, -50%) scale(1);
        }

        .welcome-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 167, 255, 0.3);
        }

        .welcome-title {
            font-size: 1.5rem;
            color: #00ccff;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .welcome-close {
            background: none;
            border: none;
            color: #a0cfff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.2s;
        }

        .welcome-close:hover {
            color: #ffffff;
        }

        .welcome-body {
            color: #a0d0ff;
            line-height: 1.8;
            font-size: 1.1rem;
            text-align: center;
        }

        .welcome-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: block;
            border: 3px solid rgba(0, 167, 255, 0.5);
        }

        /* 训练总结样式 */
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .chart-item {
            background: rgba(0, 30, 60, 0.5);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(0, 150, 255, 0.3);
            text-align: center;
        }

        .chart-item h4 {
            color: #00ccff;
            margin-bottom: 10px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .training-summary {
            background: rgba(0, 30, 60, 0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(0, 150, 255, 0.3);
        }

        .progress-bars {
            margin: 15px 0;
        }

        .progress-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-item span:first-child {
            width: 100px;
            text-align: right;
            padding-right: 10px;
            color: #a0d0ff;
            font-size: 1.1rem;
        }

        .progress-bar {
            flex: 1;
            height: 10px;
            background: rgba(100, 150, 200, 0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 5px;
        }

        .progress-item span:last-child {
            width: 40px;
            text-align: right;
            color: #00ffcc;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .recommendations ul {
            padding-left: 20px;
            margin-top: 8px;
        }

        .recommendations li {
            margin-bottom: 6px;
            color: #a0d0ff;
            line-height: 1.4;
            font-size: 1.1rem;
        }

        .summary-container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .charts-section {
            flex: 1.5;
        }

        .analysis-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .training-summary {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .summary-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-box {
            flex: 1;
            min-width: 120px;
            background: rgba(0, 50, 100, 0.5);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(0, 150, 255, 0.3);
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #00ffcc;
            margin: 5px 0;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #a0d0ff;
        }

        /* 响应式调整 */
        @media (max-width: 992px) {
            .summary-container {
                flex-direction: column;
            }

            .modal-content {
                max-width: 98vw;
                width: 98vw;
                max-height: 95vh;
            }

            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .modal-title {
                font-size: 1.5rem;
            }

            .summary-stats {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- 标题栏 -->
    <header class="header">
        <h1>智能网球分析系统</h1>
        <div class="header-info">
            <div class="status-indicator">
                <div class="status-dot pulse"></div>
                <span>实时分析中</span>
            </div>
            <div class="datetime" id="datetime">2023年11月15日 14:30:45</div>
        </div>
    </header>

    <!-- 主仪表盘 -->
    <main class="dashboard">
        <!-- 左侧数据面板 -->
        <div class="panel panel-left">
            <div class="panel-title">
                <i class="fas fa-cogs"></i>
                系统功能
            </div>
            <div class="panel-content" style="display: flex; flex-direction: column; padding: 0;">
                <button id="btn1" class="btn-expand" style="background: #0072ff; color: white; box-shadow: 0 0 10px rgba(0, 114, 255, 0.4);">
                    <i class="fa fa-fire mr-2" style="color: #ff4444; font-size: 1.8rem;"></i>
                    <span class="btn-text">热力图</span>
                </button>
                <button id="btn2" class="btn-expand" style="background: #00c6ff; color: white; box-shadow: 0 0 10px rgba(0, 198, 255, 0.4);">
                    <i class="fa fa-eye mr-2" style="color: #180202; font-size: 1.8rem;"></i>
                    <span class="btn-text">鸟瞰图</span>
                </button>
                <button id="btn3" class="btn-expand" style="background: #00ffcc; color: #0a1a30; box-shadow: 0 0 10px rgba(0, 255, 204, 0.4);">
                    <i class="fa fa-pie-chart mr-2" style="color: #00C851; font-size: 1.8rem;"></i>
                    <span class="btn-text">成绩统计图</span>
                </button>
                <button id="btn4" class="btn-expand" style="background: #ff6666; color: white; box-shadow: 0 0 10px rgba(255, 102, 102, 0.4);">
                    <i class="fa fa-line-chart mr-2" style="color: #ffbb33; font-size: 1.8rem;"></i>
                    <span class="btn-text">加速度图</span>
                </button>
                <button id="btn5" class="btn-expand" style="background: #aa66cc; color: white; box-shadow: 0 0 10px rgba(170, 102, 204, 0.4);">
                    <i class="fa fa-random mr-2" style="color: #ffff00; font-size: 1.8rem;"></i>
                    <span class="btn-text">挥拍轨迹图</span>
                </button>
            </div>
        </div>

        <!-- 中间视频区域 -->
        <div class="video-section">
            <div class="camera-container">
                <div class="camera-feed" id="camera-feed">
                    <img id="live-stream" style="width: 100%; height: 100%; object-fit: cover; display: none;" />
                    <div class="camera-placeholder">
                        <i class="fas fa-video" style="font-size: 5rem; color: rgba(100, 180, 255, 0.3); margin-bottom: 20px;"></i>
                        <p style="font-size: 1.5rem; color: #66aaff; margin-bottom: 15px;">等待OpenCV帧流接入</p>
                        <p style="color: #88aadd; max-width: 80%; line-height: 1.6;">
                            请确保Python服务已启动，点击"重新连接"接收处理后的画面
                        </p>
                    </div>
                </div>
                <div class="camera-overlay">
                    <div class="camera-title">网球姿态分析 - 实时帧流</div>
                    <div class="camera-info">
                        <div class="camera-stats">
                            <i class="fas fa-image"></i> 姿态识别中
                        </div>
                    </div>
                </div>
            </div>
            <div class="camera-controls" style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button class="camera-btn" id="connect-btn" style="flex:1; min-width: 150px; background: rgba(0, 120, 215, 0.3); border: 1px solid rgba(0, 150, 255, 0.5); color: #a0d0ff; padding: 12px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-sync-alt"></i> 重新连接
                </button>
                <button class="camera-btn" style="flex:1; min-width: 150px; background: rgba(0, 120, 215, 0.3); border: 1px solid rgba(0, 150, 255, 0.5); color: #a0d0ff; padding: 12px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-expand"></i> 全屏
                </button>
                <button id="end-training-btn" class="camera-btn" style="flex:1; min-width: 150px; background: rgba(215, 40, 40, 0.3); border: 1px solid rgba(255, 100, 100, 0.5); color: #ffa0a0; padding: 12px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-flag-checkered"></i> 结束训练
                </button>
            </div>
        </div>

        <!-- 右侧分析面板 -->
        <div class="panel panel-right">
            <div class="panel-title">
                <i class="fas fa-brain"></i>
                AI分析结果
            </div>
            <div class="panel-content" id="evaluation-list">
                <div class="placeholder">
                    <i class="fas fa-robot"></i>
                    <p>实时分析结果面板</p>
                    <p>（等待数据处理）</p>
                </div>
            </div>
        </div>
    </main>

    <!-- 浮动按钮 -->
    <img id="floating-btn" src="/static/tennis_prince.jpg" alt="网球王子"
        style="position: fixed; left: 20px; bottom: 20px; width: 80px; height: 80px; border-radius: 50%;
                cursor: move; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.5); transition: transform 0.2s;">

    <!-- 欢迎对话框 -->
    <div class="welcome-modal" id="welcomeModal">
        <div class="welcome-header">
            <h3 class="welcome-title">
                <i class="fas fa-tennis-ball"></i> 网球王子
            </h3>
            <button class="welcome-close" id="welcomeClose">×</button>
        </div>
        <div class="welcome-body">
            <img src="/static/tennis_prince.jpg" alt="网球王子" class="welcome-avatar">
            <p>您好！我是网球王子，专注于网球训练数据分析。有任何关于网球训练的问题，都可以问我哦！</p>
        </div>
    </div>

    <!-- 模态框1：热力图 -->
    <div id="modal1" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-fire mr-2"></i>热力图分析</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 1rem;">
                    <img src="static/images/hot.png" alt="网球击球热力图" class="w-full h-auto rounded-lg mb-4">
                </div>
                <p>热力图显示了球员在网球场上的活动频率和击球热点区域。颜色越红表示该区域活动或击球次数越多，有助于分析球员的偏好区域和战术模式。</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn close-modal">关闭</button>
            </div>
        </div>
    </div>

    <!-- 模态框2：鸟瞰图 -->
    <div id="modal2" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-eye mr-2"></i>鸟瞰图分析</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 1rem;">
                    <img src="static/images/bird.png" alt="网球场地鸟瞰图" class="w-full h-auto rounded-lg mb-4">
                </div>
                <p>鸟瞰图展示了球员在整个网球场上的移动轨迹和位置分布。通过分析轨迹密度和覆盖范围，可以评估球员的防守范围、移动效率和战术跑位。</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn close-modal">关闭</button>
            </div>
        </div>
    </div>

    <!-- 模态框3：成绩统计图 -->
    <div id="modal3" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-pie-chart mr-2"></i>击球类型分析</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 1rem;">
                    <img src="static/images/score.png" alt="网球击球类型成绩统计图" class="w-full h-auto rounded-lg mb-4">
                </div>
                <p>成绩统计图直观展示了球员各种击球类型的分布比例，包括正手、反手、截击、高压等。通过分析成绩统计图，可以了解球员的技术优势和弱点，优化训练重点。</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn close-modal">关闭</button>
            </div>
        </div>
    </div>

    <!-- 模态框4：加速度图 -->
    <div id="modal4" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-line-chart mr-2"></i>加速度分析</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div id="acceleration-chart" style="height: 500px;"></div>
                </div>
                <p style="margin-top: 20px;">加速度图显示了球员在击球过程中的挥拍加速度变化。通过分析峰值加速度、加速度曲线形态，可以评估击球力量、节奏控制和技术效率。</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn close-modal">关闭</button>
                <button id="reload-acceleration-btn" class="modal-btn">
                    <i class="fas fa-sync-alt"></i> 重新加载数据
                </button>
            </div>
        </div>
    </div>

    <!-- 模态框5：挥拍轨迹图 -->
    <div id="modal5" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fa fa-random mr-2"></i>挥拍轨迹图分析</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div id="track-chart" style="height: 500px;"></div>
                </div>
                <p style="margin-top: 20px;">挥拍轨迹图记录了球员从准备姿势到击球完成的完整手臂运动路径。通过分析轨迹的流畅度、弧度和起止点位置，能精准评估动作规范性与发力效率。</p>
            </div>
            <div class="modal-footer">
                <button class="modal-btn close-modal">关闭</button>
                <button id="reload-track-btn" class="modal-btn">
                    <i class="fas fa-sync-alt"></i> 重新加载数据
                </button>
            </div>
        </div>
    </div>

    <!-- 训练总结模态框 -->
    <div id="modal-summary" class="modal-backdrop">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-flag-checkered mr-2"></i>训练总结报告</h3>
                <button class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div class="summary-stats">
                    <div class="stat-box">
                        <div class="stat-value">45分钟</div>
                        <div class="stat-label">训练时长</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">286次</div>
                        <div class="stat-label">总击球数</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">82%</div>
                        <div class="stat-label">平均成功率</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value">125km/h</div>
                        <div class="stat-label">最大速度</div>
                    </div>
                </div>
                <div class="summary-container">
                    <div class="charts-section">
                        <div class="chart-grid">
                            <div class="chart-item">
                                <h4><i class="fa fa-fire mr-2"></i>热力图</h4>
                                <img src="static/images/hot.png" alt="网球击球热力图" class="chart-img">
                                <p>击球热点区域分布：正手区活跃度较高</p>
                            </div>
                            <div class="chart-item">
                                <h4><i class="fa fa-eye mr-2"></i>鸟瞰图</h4>
                                <img src="static/images/bird.png" alt="网球场地鸟瞰图" class="chart-img">
                                <p>全场覆盖范围：左侧区域移动较少</p>
                            </div>
                            <div class="chart-item">
                                <h4><i class="fa fa-pie-chart mr-2"></i>击球类型</h4>
                                <img src="static/images/score.png" alt="网球击球类型成绩统计图" class="chart-img">
                                <p>正手：65% | 反手：25% | 截击：10%</p>
                            </div>
                            <div class="chart-item">
                                <h4><i class="fa fa-line-chart mr-2"></i>加速度</h4>
                                <img src="static/images/acce.png" alt="网球挥拍加速度图" class="chart-img">
                                <p>最大挥拍速度：125 km/h</p>
                            </div>
                        </div>
                    </div>
                    <div class="analysis-section">
                        <div class="training-summary">
                            <h4><i class="fas fa-chart-line mr-2"></i>技能分析</h4>
                            <div class="progress-bars">
                                <div class="progress-item">
                                    <span>正手稳定性</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 85%; background: linear-gradient(90deg, #00c6ff, #0072ff);"></div>
                                    </div>
                                    <span>85%</span>
                                </div>
                                <div class="progress-item">
                                    <span>反手控制</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 72%; background: linear-gradient(90deg, #00ffcc, #00C851);"></div>
                                    </div>
                                    <span>72%</span>
                                </div>
                                <div class="progress-item">
                                    <span>移动效率</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 78%; background: linear-gradient(90deg, #ff9966, #ff5e62);"></div>
                                    </div>
                                    <span>78%</span>
                                </div>
                                <div class="progress-item">
                                    <span>发球准确度</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 68%; background: linear-gradient(90deg, #aa66ff, #6610f2);"></div>
                                    </div>
                                    <span>68%</span>
                                </div>
                            </div>
                            <div class="recommendations">
                                <h5><i class="fas fa-lightbulb mr-2"></i>训练建议：</h5>
                                <ul>
                                    <li>加强反手击球练习，提高稳定性和控制力</li>
                                    <li>增加左侧区域移动训练，改善覆盖范围</li>
                                    <li>尝试不同角度截击练习，提高网前得分能力</li>
                                    <li>优化发球动作，减少双误次数</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn close-modal">关闭</button>
                <button id="save-report-btn" class="modal-btn" style="background: rgba(0, 150, 80, 0.3); border-color: rgba(0, 200, 100, 0.5);">
                    <i class="fas fa-download"></i> 保存报告
                </button>
            </div>
        </div>
    </div>

    <script>
        // 浮动按钮功能
        const floatingBtn = document.getElementById('floating-btn');
        let isDragging = false;
        let offsetX, offsetY;
        let hasMoved = false;

        floatingBtn.addEventListener('mousedown', (e) => {
            isDragging = true;
            hasMoved = false;
            offsetX = e.clientX - floatingBtn.getBoundingClientRect().left;
            offsetY = e.clientY - floatingBtn.getBoundingClientRect().top;
            floatingBtn.style.cursor = 'grabbing';
        });

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                hasMoved = true;
                floatingBtn.style.left = (e.clientX - offsetX) + 'px';
                floatingBtn.style.bottom = (window.innerHeight - e.clientY + offsetY) + 'px';
            }
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                floatingBtn.style.cursor = 'move';
                if (!hasMoved) {
                    window.location.href = '/ai.html';
                }
            }
        });

        // 更新时间显示
        function updateDateTime() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('zh-CN', options);
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // 帧流相关逻辑
        const streamImg = document.getElementById('live-stream');
        const placeholder = document.querySelector('.camera-placeholder');
        const statsElement = document.querySelector('.camera-stats:last-child');
        const fpsElement = document.getElementById('fps');
        let lastFrameTime = 0;
        let frameCount = 0;
        let fpsInterval;

        function connectStream() {
            const streamUrl = 'http://localhost:5001/opencv-stream';
            streamImg.onload = function() {
                streamImg.style.display = 'block';
                placeholder.style.display = 'none';
                const now = performance.now();
                frameCount++;
                if (now - lastFrameTime >= 1000) {
                    fpsElement.textContent = Math.round((frameCount * 1000) / (now - lastFrameTime));
                    frameCount = 0;
                    lastFrameTime = now;
                }
            };
            streamImg.onerror = function() {
                streamImg.style.display = 'none';
                placeholder.style.display = 'flex';
                placeholder.innerHTML = `
                    <i class="fas fa-exclamation-triangle" style="font-size: 5rem; color: #ff6666; margin-bottom: 20px;"></i>
                    <p style="font-size: 1.5rem; color: #ff6666; margin-bottom: 15px;">帧流连接失败</p>
                    <p style="color: #88aadd; max-width: 80%;">
                        请检查Python服务是否运行，或刷新页面重试
                    </p>
                `;
                statsElement.innerHTML = '<i class="fas fa-times"></i> 连接失败';
            };
            streamImg.src = streamUrl + '?' + new Date().getTime();
            fpsInterval = setInterval(() => {
                if (streamImg.style.display === 'block') {
                    const now = performance.now();
                    if (now - lastFrameTime >= 1000) {
                        fpsElement.textContent = Math.round((frameCount * 1000) / (now - lastFrameTime));
                        frameCount = 0;
                        lastFrameTime = now;
                    }
                }
            }, 1000);
        }

        document.getElementById('connect-btn').addEventListener('click', connectStream);

        // 模态框控制
        const buttons = [
            document.getElementById('btn1'),
            document.getElementById('btn2'),
            document.getElementById('btn3'),
            document.getElementById('btn4'),
            document.getElementById('btn5')
        ];

        const modals = [
            document.getElementById('modal1'),
            document.getElementById('modal2'),
            document.getElementById('modal3'),
            document.getElementById('modal4'),
            document.getElementById('modal5')
        ];

        buttons.forEach((btn, index) => {
            btn.addEventListener('click', () => {
                modals[index].classList.add('active');
                document.body.style.overflow = 'hidden';
            });
        });

        function closeModal(modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
        }

        document.querySelectorAll('.close-modal, .modal-close').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.modal-backdrop');
                if (modal) closeModal(modal);
            });
        });

        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal);
                }
            });
        });

        document.getElementById('end-training-btn').addEventListener('click', () => {
            document.getElementById('modal-summary').classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        document.getElementById('save-report-btn').addEventListener('click', () => {
            alert('训练报告已保存！您可以在历史记录中查看。');
            document.getElementById('modal-summary').classList.remove('active');
            document.body.style.overflow = '';
        });

        const allModals = [...modals, document.getElementById('modal-summary')];

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                allModals.forEach(modal => {
                    if (modal.classList.contains('active')) {
                        closeModal(modal);
                    }
                });
            }
        });

        // 欢迎对话框逻辑
        document.addEventListener('DOMContentLoaded', () => {
            const welcomeModal = document.getElementById('welcomeModal');
            const welcomeClose = document.getElementById('welcomeClose');

            setTimeout(() => {
                welcomeModal.classList.add('active');
            }, 500);

            welcomeClose.addEventListener('click', () => {
                welcomeModal.classList.remove('active');
            });

            setTimeout(() => {
                welcomeModal.classList.remove('active');
            }, 8000);

            // 评价显示逻辑
            let lastEvaluationId = null;
            let displayedEvaluations = [];
            const maxEvaluations = 5; // 最大显示的评价数量

            function fetchEvaluations() {
                console.log('正在获取评价数据...');
                fetch('http://127.0.0.1:5000/api/evaluations', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP错误! 状态: ${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('收到数据:', data);
                        const evaluationList = document.getElementById('evaluation-list');
                        if (data.evaluations && data.evaluations.length > 0) {
                            const latestEval = data.evaluations[data.evaluations.length - 1];
                            if (lastEvaluationId === null || latestEval.id !== lastEvaluationId) {
                                lastEvaluationId = latestEval.id;
                                const date = new Date(latestEval.timestamp * 1000);
                                const timeStr = date.toLocaleTimeString('zh-CN', { hour12: false });
                                const evalDiv = document.createElement('div');
                                evalDiv.className = 'shot-evaluation';
                                evalDiv.innerHTML = `
                                    <h4>击球 评分 ${latestEval.score}/100</h4>
                                    <p>${latestEval.comments}</p>
                                `;
                                // 在顶部插入新评价
                                evaluationList.insertBefore(evalDiv, evaluationList.firstChild);
                                displayedEvaluations.unshift(evalDiv);

                                // 如果评价数量超过最大限制，移除最早的评价
                                if (displayedEvaluations.length > maxEvaluations) {
                                    const oldestEval = displayedEvaluations.pop();
                                    oldestEval.classList.add('fade-out');
                                    setTimeout(() => {
                                        oldestEval.remove();
                                    }, 500); // 等待淡出动画完成
                                }

                                // 移除占位符
                                const placeholder = evaluationList.querySelector('.placeholder');
                                if (placeholder) {
                                    placeholder.remove();
                                }
                            }
                        } else {
                            console.log('无评价数据');
                            if (displayedEvaluations.length === 0) {
                                evaluationList.innerHTML = `
                                    <div class="placeholder">
                                        <i class="fas fa-robot"></i>
                                        <p>实时分析结果面板</p>
                                        <p>（无数据，请等待处理）</p>
                                    </div>
                                `;
                            }
                        }
                    })
                    .catch(error => {
                        console.error('获取评价失败:', error);
                        const evaluationList = document.getElementById('evaluation-list');
                        if (displayedEvaluations.length === 0) {
                            evaluationList.innerHTML = `
                                <div class="placeholder">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <p>加载评价失败: ${error.message}</p>
                                    <p>请检查服务状态或刷新页面</p>
                                </div>
                            `;
                        }
                    });
            }

            fetchEvaluations();
            setInterval(fetchEvaluations, 2000);
        });

        let trackChart = null;
        let accelerationChart = null;

        // 加载并绘制轨迹数据
        function loadAndPlotTrackData() {
            fetch('/api/track-data')
                .then(response => response.json())
                .then(data => {
                    // 绘制3D轨迹图
                    const trace = {
                        x: data.positions.x,
                        y: data.positions.y,
                        z: data.positions.z,
                        type: 'scatter3d',
                        mode: 'lines+markers',
                        marker: {
                            size: 4,
                            color: data.times,
                            colorscale: 'Viridis',
                            showscale: true
                        },
                        line: {
                            color: 'rgb(0, 200, 255)',
                            width: 6
                        },
                        name: '挥拍轨迹'
                    };
                    
                    const layout = {
                        title: '网球挥拍三维轨迹',
                        scene: {
                            xaxis: { title: 'X轴位置 (m)' },
                            yaxis: { title: 'Y轴位置 (m)' },
                            zaxis: { title: 'Z轴位置 (m)' },
                            camera: {
                                eye: { x: 1.5, y: 1.5, z: 0.8 }
                            }
                        },
                        margin: { l: 0, r: 0, b: 0, t: 40 }
                    };
                    
                    if (trackChart) {
                        Plotly.react('track-chart', [trace], layout);
                    } else {
                        trackChart = Plotly.newPlot('track-chart', [trace], layout);
                    }
                })
                .catch(error => {
                    console.error('获取轨迹数据失败:', error);
                    alert('加载挥拍轨迹数据失败，请检查服务状态');
                });
        }

        // 加载并绘制加速度数据
        function loadAndPlotAccelerationData() {
            fetch('/api/track-data')
                .then(response => response.json())
                .then(data => {
                    // 绘制加速度图
                    const accTraceX = {
                        x: data.times,
                        y: data.accelerations.ax,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'X轴加速度',
                        line: { color: '#FF6384', width: 3 }
                    };
                    
                    const accTraceY = {
                        x: data.times,
                        y: data.accelerations.ay,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Y轴加速度',
                        line: { color: '#36A2EB', width: 3 }
                    };
                    
                    const accTraceZ = {
                        x: data.times,
                        y: data.accelerations.az,
                        type: 'scatter',
                        mode: 'lines',
                        name: 'Z轴加速度',
                        line: { color: '#4BC0C0', width: 3 }
                    };
                    
                    const accLayout = {
                        title: '三轴加速度变化曲线',
                        xaxis: { title: '时间 (ms)' },
                        yaxis: { title: '加速度 (m/s²)' },
                        margin: { t: 40 },
                        showlegend: true
                    };
                    
                    if (accelerationChart) {
                        Plotly.react('acceleration-chart', [accTraceX, accTraceY, accTraceZ], accLayout);
                    } else {
                        accelerationChart = Plotly.newPlot('acceleration-chart', [accTraceX, accTraceY, accTraceZ], accLayout);
                    }
                })
                .catch(error => {
                    console.error('获取加速度数据失败:', error);
                    alert('加载加速度数据失败，请检查服务状态');
                });
        }

        // 修改挥拍轨迹图按钮的点击事件
        document.getElementById('btn5').addEventListener('click', () => {
            const modal = document.getElementById('modal5');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // 加载轨迹数据并绘图
            loadAndPlotTrackData();
        });

        // 修改加速度图按钮的点击事件
        document.getElementById('btn4').addEventListener('click', () => {
            const modal = document.getElementById('modal4');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // 加载加速度数据并绘图
            loadAndPlotAccelerationData();
        });

        // 添加重新加载按钮事件
        document.getElementById('reload-track-btn').addEventListener('click', loadAndPlotTrackData);
        document.getElementById('reload-acceleration-btn').addEventListener('click', loadAndPlotAccelerationData);
    </script>
</body>
</html>